paths:
  login:
    tags: [Auth]
    summary: Log in
    description: Logs a user in and returns an authentication token.
    operationId: login
    security:
      - BasicAuth: []
    responses:
      "200":
        description: Success
        content:
          application/json:
            schema: { $ref: "#/components/schemas/LoginResponse" }
      "401": { $ref: "../shared.yaml#/components/responses/Unauthorized" }
  set_member_recovery_email_address:
    tags: [Auth]
    summary: Set member recovery email address
    description: Set a member’s recovery email address.
    operationId: set_member_recovery_email_address
    security:
      - BearerAuth: []
    parameters:
      - $ref: "members.yaml#/components/parameters/MemberId"
    requestBody:
      required: true
      content:
        application/json:
          schema: { $ref: "../shared.yaml#/components/schemas/EmailAddress" }
    responses:
      "204": { description: Success }
      "401": { $ref: "../shared.yaml#/components/responses/Unauthorized" }
      "403": { $ref: "../shared.yaml#/components/responses/Forbidden" }
  get_member_recovery_email_address:
    tags: [Auth]
    summary: Get member recovery email address
    description: Get a member’s recovery email address.
    operationId: get_member_recovery_email_address
    security:
      - BearerAuth: []
    parameters:
      - $ref: "members.yaml#/components/parameters/MemberId"
    responses:
      "200":
        description: Success
        content:
          application/json:
            schema:
              $ref: "../shared.yaml#/components/schemas/EmailAddress"
              type: [string, "null"]
      "401": { $ref: "../shared.yaml#/components/responses/Unauthorized" }
      "403": { $ref: "../shared.yaml#/components/responses/Forbidden" }
  request_password_reset:
    tags: [Auth]
    summary: Request password reset
    description: Sends a password reset link to a member (via email).
    operationId: request_password_reset
    security:
      - BasicAuth: []
    parameters:
      - $ref: "members.yaml#/components/parameters/MemberId"
    responses:
      "202":
        description: Success (password reset link sent)
        content:
          application/json:
            schema: { $ref: "#/components/schemas/PasswordResetNotificationPayload" }
      "401": { $ref: "../shared.yaml#/components/responses/Unauthorized" }
      "403": { $ref: "../shared.yaml#/components/responses/Forbidden" }
  reset_password:
    tags: [Auth]
    summary: Reset password
    description: Uses a password reset token to reset someone’s password.
    operationId: reset_password
    security: []
    parameters:
      - name: token
        in: path
        required: true
        schema: { $ref: "#/components/schemas/PasswordResetToken" }
    requestBody:
      required: true
      content:
        application/json:
          schema: { $ref: "#/components/schemas/ResetPasswordRequest" }
    responses:
      "200":
        description: Success
      "404":
        description: Token not found (expired or already used)
        content:
          application/json:
            schema:
              $ref: "../shared.yaml#/components/schemas/Error"
              properties:
                error:
                  const: password_reset_token_expired
            example:
              error: password_reset_token_expired
      "410":
        description: Token expired not long ago (rare)
        content:
          application/json:
            schema:
              $ref: "../shared.yaml#/components/schemas/Error"
              properties:
                error:
                  const: password_reset_token_expired
            example:
              error: password_reset_token_expired

components:
  schemas:
    LoginResponse:
      type: object
      required:
        - token
      properties:
        token:
          title: An authentication token
          type: string
          format: password
          example: eyJhbGciOiJIUzI1NiJ9.eyJqaWQiOiJleGFtcGxlQHByb3NlLm9yZy5sb2NhbCJ9.y88lyu9q0dFx9zYxllJo3XUtNnyc3Z_ad3w1hsfTJQ0
    PasswordResetToken:
      type: string
      format: password
      example: d4DPhMhrIJtQ0_hvq-keGrNX
    ResetPasswordRequest:
      type: object
      required:
        - password
      properties:
        password: { $ref: "../shared.yaml#/components/schemas/Password" }
    PasswordResetNotificationPayload:
      type: object
      required:
        - token
        - expires_at
        - url
      properties:
        token: { $ref: "#/components/schemas/PasswordResetToken" }
        expires_at: { $ref: "../shared.yaml#/components/schemas/DateTime" }
        url:
          type: string
          format: uri
          example: https://admin.prose.company.com/invitations/accept/d4DPhMhrIJtQ0_hvq-keGrNX
